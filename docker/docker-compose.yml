version: '2'
services:
    nginx-proxy:
        image: jwilder/nginx-proxy
        restart: always
        container_name: nginx_proxy
        ports:
            - "80:80"
            - "443:443"
        volumes:
          - /var/run/docker.sock:/tmp/docker.sock:ro
          - letsencrypt-certs:/etc/nginx/certs
          - letsencrypt-vhost-d:/etc/nginx/vhost.d
          - letsencrypt-html:/usr/share/nginx/html
        labels:
          - "com.github.jrcs.letsencrypt_nginx_proxy_companion.nginx_proxy"


    letsencrypt-proxy:
      image: nginxproxy/acme-companion
      container_name: letsencrypt-proxy
      volumes:
        - /var/run/docker.sock:/var/run/docker.sock:ro
        - letsencrypt-certs:/etc/nginx/certs
        - letsencrypt-vhost-d:/etc/nginx/vhost.d
      volumes_from:
        - nginx-proxy
      environment:
        - DEFAULT_EMAIL=mikeldiezgarcia@gmail.com
        - NGINX_PROXY_CONTAINER=nginx-proxy
      depends_on:
        - "nginx-proxy"


    wordle1:
      build:
        context: ../
        dockerfile: docker/Dockerfile
      image: teleco_prod:v0.1
      expose:
          - 3000
      container_name: wordle_teleco
      environment:
        - VIRTUAL_HOST=wordle.arraiz.me
        - LETSENCRYPT_HOST=wordle.arraiz.me
        - HTTPS_METHOD=redirect
      depends_on:
        - "nginx-proxy"
        - "letsencrypt-proxy" 

volumes:
  letsencrypt-certs:
  letsencrypt-vhost-d:
  letsencrypt-html: